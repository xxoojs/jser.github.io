!(function($){
	function iRotate($el, callback){
		this.render($el, callback);
	}

	iRotate.prototype = {
		constructor: iRotate,

		render: function($el, callback){
			var elRect = $el[0].getBoundingClientRect(),
				initY = elRect.bottom;

			$el.mousedown(function(downevent){
				var downX = downevent.pageX,
					downY = downevent.pageY;
				$(document).mousemove(function(moveevent){
					var moveX = moveevent.pageX,
						moveY = moveevent.pageY;

					var angle = -(moveY - initY);

					$el.css('transform', 'rotateZ(' + (angle > 55 ? 55 : (angle < -10 ? -10 : angle)) + 'deg)');
					callback && callback();

					$(document).mouseup(function(upevent){
						$(document).off('mousemove').off('mouseup');
					});
				});
			});
		}
	};

	!(function () {
        var old = $.fn.iRotate;
        $.fn.iRotate = function (callback) {
            return this.each(function () {
                var $this = $(this);

                new iRotate($this, callback);
            });
        }
        $.fn.iRotate.constructor = iRotate;
        $.fn.iRotate.defaults = {};
        $.fn.iRotate.noConflict = function () {
            $.fn.iRotate = old;
            return this;
        }
    })();
})(jQuery);

!(function($){
	function iDialog(json){
		this.create(json);
	}

	iDialog.prototype = {
		$el: '',

		create: function(json){
			var that = this;
			$.ajax({
				url: 'resource/tmpl/dialog.html',
				success: function(data){
					var tmpl = data.replace('${url}', json.url)
										.replace('${title}', json.title)
											.replace('${icon}', json.icon)
												.replaceAll('${data}', json.data)
													.replace('${time}', new Date());
					that.$el = $(tmpl);

					that.evtBind();

					that.$el.appendTo($('body'));
				}
			});
		},

		evtBind: function(){
			var that = this;
			this.$el.find('.close').click(function(){
				that.close();
			});
		},

		open: function(){

		},

		close: function(){
			this.$el.remove();
		}
	};

	!(function(){
		var old = $.iDialog;
		$.iDialog = function(json){
			return new iDialog(json);
		};
		$.iDialog.constructor = iDialog;
		$.iDialog.defaults = {};
		$.iDialog.noConfict = function(){
			$.iDialog = old;
			return this;
		}
	})();
})(jQuery);

// @koala-prepend "source/rotate.js";
// @koala-prepend "source/dialog.js";